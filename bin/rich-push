#!/usr/bin/env node
const { program } = require('commander');
const shell = require('shelljs');
const chalk = require('chalk');
const { isRemoteBranch, gitBranchIs } = require('../lib/utils.js')

program
  .name('rich')
  .usage('push <remote>')
  .on('--help', () => {
    console.log('  例如:')
    console.log()
    console.log(chalk.gray('    # 推送代码到远程'))
    console.log('    $ rich push origin')
    console.log()
  })
  .on('exit', console.log)
  .parse(process.argv)

const remoteName = program.args[0]

function help () {
  if (program.args.length < 1) return program.help()
}

help()

async function run() {
  const localName = await gitBranchIs()
  const isRemote = await isRemoteBranch(localName) 
  if (!isRemote && remoteName) {
    shell.exec(`git push ${remoteName} -u ${localName}`)
  } else {
    shell.exec('git push')
  }
}

run()