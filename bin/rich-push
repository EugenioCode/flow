#!/usr/bin/env node
const { program } = require('commander');
const shell = require('shelljs');
const chalk = require('chalk');
const { isRemoteBranch, gitBranchIs } = require('../lib/utils.js')

program
  .name('rich')
  .usage('push')
  .on('--help', () => {
    console.log()
    console.log(chalk.gray('    # git push to remote'))
    console.log('    $ rich push')
    console.log()
  })

function help () {
  if (program.args.length < 1) return program.help()
}

help()

const remoteName = program.args[0]

process.on('exit', () => {
  console.log()
})


async function run() {
  const localName = await gitBranchIs()
  const isRemote = await isRemoteBranch(localName) 
  if (!isRemote && remoteName) {
    shell.exec(`git push ${remoteName} -u ${localName}`)
  } else {
    shell.exec('git push')
  }
}

run()